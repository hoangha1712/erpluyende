<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luyende.ai - ƒê∆∞·ªùng ƒêua Sƒ© T·ª≠ (Final 3 Questions)</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-blue: #2563EB;
            --action-orange: #F97316;
            --bg-light: #F9FAFB;
            --text-dark: #111827;
            --text-gray: #6B7280;
            --white: #FFFFFF;
            --border: #E5E7EB;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg-light); color: var(--text-dark); padding-bottom: 80px; -webkit-font-smoothing: antialiased; }

        /* HEADER */
        header {
            background-color: var(--white);
            border-bottom: 1px solid var(--border);
            padding: 12px 20px;
            position: sticky; top: 0; z-index: 50;
            display: flex; justify-content: space-between; align-items: center;
        }
        .logo-container { font-weight: 800; color: var(--primary-blue); font-size: 18px; }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .points-badge { 
            background: #FFF7ED; color: var(--action-orange); 
            padding: 4px 10px; border-radius: 20px; 
            font-size: 13px; font-weight: 700; border: 1px solid #FFEDD5;
        }
        .avatar { 
            width: 36px; height: 36px; background: #EFF6FF; 
            border-radius: 50%; color: var(--primary-blue); 
            display: flex; align-items: center; justify-content: center; font-size: 14px;
        }

        /* HERO */
        .hero {
            background: linear-gradient(135deg, var(--primary-blue) 0%, #1D4ED8 100%);
            color: white; padding: 30px 20px 50px 20px;
            text-align: center; border-radius: 0 0 24px 24px; margin-bottom: -30px;
        }
        .hero h1 { font-size: 20px; font-weight: 700; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
        .hero p { font-size: 13px; opacity: 0.9; font-weight: 400; }

        /* BOARD */
        .container { max-width: 500px; margin: 0 auto; padding: 0 16px; position: relative; z-index: 10; }
        
        .board-header {
            display: flex; align-items: center; gap: 8px;
            margin-bottom: 16px; padding-left: 4px;
        }
        .board-header h2 { font-size: 16px; font-weight: 700; color: var(--text-dark); }
        .board-header i { color: var(--action-orange); }

        .task-list { display: flex; flex-direction: column; gap: 12px; position: relative; min-height: 300px; }

        /* TASK CARD */
        .task-card {
            background: var(--white); border-radius: 16px; padding: 16px;
            display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            animation: slideUp 0.4s ease forwards;
            opacity: 0; transform: translateY(10px);
        }
        
        .task-left { display: flex; align-items: center; gap: 14px; flex: 1; }
        .task-icon {
            width: 44px; height: 44px; border-radius: 12px;
            background: #F3F4F6; color: var(--text-gray);
            display: flex; align-items: center; justify-content: center; font-size: 18px;
            flex-shrink: 0;
        }
        .task-info h3 { font-size: 14px; font-weight: 600; color: var(--text-dark); margin-bottom: 2px; }
        .task-info p { font-size: 12px; color: var(--text-gray); }

        .btn-action {
            padding: 8px 14px; border-radius: 20px; border: none;
            font-size: 12px; font-weight: 600; cursor: pointer;
            background: #F3F4F6; color: var(--text-gray); white-space: nowrap;
        }

        /* CARD STATES */
        .task-card.trigger-card {
            border: 2px solid var(--action-orange);
            background: #FFF7ED;
            position: relative; z-index: 20; cursor: pointer;
        }
        .task-card.trigger-card .task-icon { background: white; color: var(--action-orange); font-size: 20px; }
        .task-card.trigger-card .btn-action {
            background: var(--action-orange); color: white;
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.25);
            animation: pulse 2s infinite;
        }

        .task-card.locked {
            filter: blur(2px) grayscale(80%); opacity: 0.6; pointer-events: none; user-select: none;
        }
        .lock-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            display: flex; align-items: center; justify-content: center; z-index: 5;
        }

        /* MODAL */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px);
            z-index: 1000; display: none; opacity: 0;
            transition: opacity 0.3s ease; align-items: center; justify-content: center;
        }
        .modal-overlay.show { display: flex; opacity: 1; }

        .modal-box {
            background: white; width: 90%; max-width: 420px;
            border-radius: 24px; padding: 24px; position: relative;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            transform: translateY(20px); transition: transform 0.3s ease;
        }
        .modal-overlay.show .modal-box { transform: translateY(0); }

        .close-btn {
            position: absolute; top: 16px; right: 16px;
            width: 32px; height: 32px; border-radius: 50%;
            background: #F3F4F6; color: #9CA3AF;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.2s; font-size: 16px;
        }
        .close-btn:hover { background: #E5E7EB; color: #4B5563; }

        /* QUIZ */
        .progress-container { width: 100%; height: 6px; background: #F3F4F6; border-radius: 10px; margin: 10px 0 24px 0; overflow: hidden;}
        .progress-bar { height: 100%; background: var(--action-orange); width: 33%; transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1); }

        .question-text { font-size: 18px; font-weight: 700; color: var(--text-dark); margin-bottom: 20px; line-height: 1.4; }
        
        .option-item {
            border: 2px solid #E5E7EB; border-radius: 12px; padding: 14px;
            margin-bottom: 12px; cursor: pointer; transition: all 0.2s;
            display: flex; align-items: flex-start; gap: 12px;
        }
        .option-item:hover, .option-item.selected { border-color: #FDBA74; background: #FFF7ED; }
        .radio-circle {
            width: 20px; height: 20px; border: 2px solid #D1D5DB; border-radius: 50%;
            margin-top: 2px; flex-shrink: 0; position: relative;
        }
        .option-item:hover .radio-circle, .option-item.selected .radio-circle { border-color: var(--action-orange); }
        .option-item.selected .radio-circle::after {
            content: ''; position: absolute; top: 3px; left: 3px; width: 10px; height: 10px;
            background: var(--action-orange); border-radius: 50%;
        }
        .option-text { font-size: 14px; color: #4B5563; line-height: 1.4; }

        .toast {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px);
            background: #374151; color: white; padding: 12px 24px; border-radius: 30px;
            font-size: 13px; font-weight: 500; z-index: 2000; opacity: 0; transition: all 0.4s;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); display: flex; align-items: center; gap: 8px; width: max-content;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(249, 115, 22, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(249, 115, 22, 0); } 100% { box-shadow: 0 0 0 0 rgba(249, 115, 22, 0); } }
        @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }

        .countdown-text { color: #9CA3AF; font-size: 12px; margin-top: 12px; }
    </style>
</head>
<body>

    <!-- HEADER -->
    <header>
        <div class="logo-container">Luyende.ai</div>
        <div class="user-info">
            <div class="points-badge">‚ö° 10</div>
            <div class="avatar"><i class="fa-solid fa-user"></i></div>
        </div>
    </header>

    <!-- HERO -->
    <section class="hero">
        <h1>ƒê∆∞·ªùng ƒêua Sƒ© T·ª≠</h1>
        <p>Ho√†n th√†nh nhi·ªám v·ª• - M·ªü kh√≥a l·ªô tr√¨nh</p>
    </section>

    <!-- CONTAINER -->
    <div class="container">
        <div class="board-header">
            <i class="fa-solid fa-layer-group"></i>
            <h2>Nhi·ªám v·ª• tu·∫ßn n√†y</h2>
        </div>

        <!-- DANH S√ÅCH NHI·ªÜM V·ª§ -->
        <div id="taskBoard" class="task-list">
            
            <!-- TRIGGER CARD -->
            <div class="task-card trigger-card" onclick="startSurvey()">
                <div class="task-left">
                    <div class="task-icon"><i class="fa-solid fa-gift"></i></div>
                    <div class="task-info">
                        <h3>K√≠ch ho·∫°t Tr·ª£ l√Ω AI & Nh·∫≠n l·ªô tr√¨nh</h3>
                        <p style="color: var(--action-orange);">Tr·∫£ l·ªùi 3 c√¢u h·ªèi ƒë·ªÉ m·ªü kh√≥a & nh·∫≠n 50ƒë</p>
                    </div>
                </div>
                <button class="btn-action">K√≠ch ho·∫°t ngay</button>
            </div>

            <!-- FAKE LOCKED TASKS -->
            <div class="task-card locked">
                <div class="task-left">
                    <div class="task-icon"><i class="fa-solid fa-lock"></i></div>
                    <div class="task-info">
                        <h3>Nhi·ªám v·ª• b√≠ m·∫≠t</h3>
                        <p>Ho√†n th√†nh k√≠ch ho·∫°t ƒë·ªÉ m·ªü</p>
                    </div>
                </div>
                <div class="lock-overlay"><i class="fa-solid fa-lock" style="color:#6B7280"></i></div>
            </div>
            
            <div class="task-card locked">
                <div class="task-left">
                    <div class="task-icon"><i class="fa-solid fa-lock"></i></div>
                    <div class="task-info">
                        <h3>Nhi·ªám v·ª• b√≠ m·∫≠t</h3>
                        <p>Ho√†n th√†nh k√≠ch ho·∫°t ƒë·ªÉ m·ªü</p>
                    </div>
                </div>
                <div class="lock-overlay"><i class="fa-solid fa-lock" style="color:#6B7280"></i></div>
            </div>
        </div>
    </div>

    <!-- 1. POPUP KH·∫¢O S√ÅT (3 C√ÇU) -->
    <div id="surveyModal" class="modal-overlay">
        <div class="modal-box">
            <div class="close-btn" onclick="closeSurveyByX()"><i class="fa-solid fa-xmark"></i></div>
            <div class="progress-container"><div class="progress-bar" id="progressBar" style="width: 33%;"></div></div>
            <div id="quizContent" style="opacity: 1;">
                <!-- JS Render -->
            </div>
        </div>
    </div>

    <!-- 2. POPUP K·∫æT QU·∫¢ (TH√îNG B√ÅO CHUNG) -->
    <div id="successModal" class="modal-overlay">
        <div class="modal-box" style="text-align: center; padding-top: 40px;">
            <div class="close-btn" onclick="finalizeUnlock()"><i class="fa-solid fa-xmark"></i></div>

            <div style="font-size: 60px; margin-bottom: 16px;">üéâ</div>
            <h2 style="color: var(--action-orange); margin-bottom: 12px; font-size: 20px;">K√≠ch ho·∫°t th√†nh c√¥ng!</h2>
            <p style="color: #4B5563; font-size: 15px; margin-bottom: 30px; line-height: 1.5;">
                B·∫°n ƒë√£ m·ªü kh√≥a th√†nh c√¥ng b·∫£ng nhi·ªám v·ª• <br><b>ƒê∆∞·ªùng ƒëua sƒ© t·ª≠</b>.
            </p>
            
            <button class="btn-action" style="background: var(--primary-blue); color: white; width: 100%; padding: 14px; font-size: 14px;" onclick="finalizeUnlock()">
                V√†o ƒê∆∞·ªùng ƒêua Ngay
            </button>
            
            <div class="countdown-text">T·ª± ƒë·ªông ƒë√≥ng sau <span id="countdownTimer">5</span>s</div>
        </div>
    </div>

    <div id="toast" class="toast">
        <i class="fa-solid fa-circle-check"></i>
        <span id="toastMsg">Th√¥ng b√°o h·ªá th·ªëng</span>
    </div>

    <script>
        /* 
           DATA CONFIGURATION: 
           - Ch·ªâ 3 c√¢u h·ªèi (T√≠nh c√°ch)
           - ƒê√£ x√≥a Mini-Quiz
        */
        const questions = [
            {
                id: 1,
                text: "G·∫∑p b√†i To√°n 'si√™u khoai', ph·∫£n x·∫° ƒë·∫ßu ti√™n c·ªßa b·∫°n l√†?",
                options: [
                    { label: "A. T·ª± l·ª±c c√°nh sinh: Tra Google, xem s√°ch, t·ª± m√≤ m·ªõi 'ƒë√£'.", score: 0 }, 
                    { label: "B. C·∫ßu c·ª©u ng∆∞·ªùi th√¢n: Ch·ª•p ·∫£nh h·ªèi b·∫°n b√®/th·∫ßy c√¥ ngay cho nhanh.", score: 1 }
                ]
            },
            {
                id: 2,
                text: "Kh√¥ng gian 'tu luy·ªán' l√Ω t∆∞·ªüng gi√∫p b·∫°n t·∫≠p trung 100%?",
                options: [
                    { label: "A. ·∫®n danh: Y√™n tƒ©nh tuy·ªát ƒë·ªëi, ƒëeo tai nghe, kh√¥ng ai l√†m phi·ªÅn.", score: 0 },
                    { label: "B. S√¥i ƒë·ªông: Ph·∫£i th·∫•y b·∫°n b√® ƒëang online, c√≥ BXH nh·∫£y s·ªë m·ªõi vui.", score: 1 }
                ]
            },
            {
                id: 3,
                text: "T∆∞·ªüng t∆∞·ª£ng v·ª´a ƒë·∫°t 9.5 ƒëi·ªÉm To√°n. C·∫£m x√∫c l√∫c ƒë√≥?",
                options: [
                    { label: "A. Vui th·∫ßm: L∆∞u l·∫°i ƒë·ªÉ t·ª± so s√°nh v·ªõi ch√≠nh m√¨nh th√¥i.", score: 0 },
                    { label: "B. Ph·∫•n kh√≠ch: Ch·ª•p m√†n h√¨nh khoe Story/B·∫°n b√® ngay l·∫≠p t·ª©c!", score: 1 }
                ]
            }
        ];

        /* DATABASE NHI·ªÜM V·ª§ (ƒê√£ x√≥a quiz_easy) */
        const tasksDB = {
            attendance: { title: "ƒêi·ªÉm danh", icon: "fa-calendar-check", sub: "+10 ƒëi·ªÉm ng√†y", btn: "ƒêi·ªÉm danh", hot: true },
            profile: { title: "Ho√†n th√†nh Profile", icon: "fa-user-pen", sub: "C·∫≠p nh·∫≠t tr∆∞·ªùng/l·ªõp", btn: "C·∫≠p nh·∫≠t", hot: false },
            share_fb: { title: "Chia s·∫ª Facebook", icon: "fa-facebook", sub: "Khoe th√†nh t√≠ch", btn: "Chia s·∫ª", hot: false },
            invite: { title: "M·ªùi b·∫°n b√®", icon: "fa-user-plus", sub: "Nh·∫≠n 50 ƒëi·ªÉm/b·∫°n", btn: "M·ªùi ngay", hot: true },
            share_result: { title: "Chia s·∫ª K·∫øt qu·∫£ h·ªçc t·∫≠p", icon: "fa-chart-line", sub: "TƒÉng kh·∫£ nƒÉng ƒë·ªó ƒêH", btn: "Chia s·∫ª", hot: true },
            quiz_advanced: { title: "Th·ª≠ th√°ch n√¢ng cao", icon: "fa-brain", sub: "Luy·ªán ƒë·ªÅ kh√≥", btn: "Chi·∫øn ngay", hot: false }
        };

        /* STATE */
        let currentStep = 0;
        let personalityScore = 0; 
        
        // GI·∫¢ L·∫¨P D·ªÆ LI·ªÜU ƒêI·ªÇM T·ª™ BACKEND/LMS (V√¨ kh√¥ng h·ªèi user n·ªØa)
        // userGradeValue: < 8.0 (average) ho·∫∑c >= 8.0 (good)
        const userGradeValue = 7.5; // B·∫°n c√≥ th·ªÉ ƒë·ªïi s·ªë n√†y ƒë·ªÉ test logic hi·ªÉn th·ªã task kh√°c nhau
        const userGradeCategory = userGradeValue >= 8.0 ? 'good' : 'average';

        let finalSegment = null;
        let countdownInterval;

        const modal = document.getElementById('surveyModal');
        const successModal = document.getElementById('successModal');
        const board = document.getElementById('taskBoard');
        const quizContent = document.getElementById('quizContent');
        const progressBar = document.getElementById('progressBar');

        /* FUNCTIONS */
        function startSurvey() {
            currentStep = 0;
            personalityScore = 0;
            renderQuestion();
            modal.classList.add('show');
        }

        function renderQuestion() {
            const q = questions[currentStep];
            progressBar.style.width = `${((currentStep + 1) / questions.length) * 100}%`;
            
            let html = `<div class="question-text">C√¢u ${currentStep + 1}: ${q.text}</div>`;
            
            q.options.forEach((opt) => {
                html += `
                <div class="option-item" onclick="chooseAnswer(${opt.score})">
                    <div class="radio-circle"></div>
                    <div class="option-text">${opt.label}</div>
                </div>`;
            });
            
            quizContent.style.opacity = 0;
            setTimeout(() => {
                quizContent.innerHTML = html;
                quizContent.style.opacity = 1;
            }, 200);
        }

        function chooseAnswer(score) {
            personalityScore += score;
            if (currentStep < questions.length - 1) {
                currentStep++;
                renderQuestion();
            } else {
                calculateSegmentAndFinish();
            }
        }

        // Logic ph√¢n lo·∫°i (Core Logic)
        function calculateSegmentAndFinish() {
            modal.classList.remove('show');

            // Introvert (Score 0-1), Extrovert (Score 2-3)
            const isIntrovert = personalityScore <= 1;
            const isGood = userGradeCategory === 'good'; // L·∫•y t·ª´ bi·∫øn gi·∫£ l·∫≠p

            // Mapping Segment ƒë·ªÉ render task
            if (isIntrovert && !isGood) finalSegment = 'introvert_average';
            else if (isIntrovert && isGood) finalSegment = 'introvert_good';
            else if (!isIntrovert && !isGood) finalSegment = 'extrovert_average';
            else finalSegment = 'extrovert_good';

            console.log("Segment detected:", finalSegment); // ƒê·ªÉ debug xem ƒëang r∆°i v√†o nh√≥m n√†o
            showSuccessPopup();
        }

        function showSuccessPopup() {
            successModal.classList.add('show');
            
            // Logic ƒë·∫øm ng∆∞·ª£c 5s
            let secondsLeft = 5;
            const timerEl = document.getElementById('countdownTimer');
            timerEl.innerText = secondsLeft;

            if(countdownInterval) clearInterval(countdownInterval);

            countdownInterval = setInterval(() => {
                secondsLeft--;
                timerEl.innerText = secondsLeft;
                if (secondsLeft <= 0) {
                    clearInterval(countdownInterval);
                    finalizeUnlock();
                }
            }, 1000);
        }

        function closeSurveyByX() {
            modal.classList.remove('show');
            showToast("ƒê√£ k√≠ch ho·∫°t ch·∫ø ƒë·ªô m·∫∑c ƒë·ªãnh");
            finalSegment = 'introvert_average'; // Default if closed
            renderUnlockedBoard(finalSegment);
        }

        function finalizeUnlock() {
            if(countdownInterval) clearInterval(countdownInterval);
            successModal.classList.remove('show');
            renderUnlockedBoard(finalSegment);
            showToast("M·ªü kh√≥a nhi·ªám v·ª• th√†nh c√¥ng!");
            document.querySelector('.points-badge').innerText = "‚ö° 50";
        }

        /* LOGIC RENDER NHI·ªÜM V·ª§ THEO SEGMENT (PDF Logic) */
        function renderUnlockedBoard(segment) {
            let tasksToShow = [];

            switch (segment) {
                case 'introvert_average': 
                    // Segment 2 (H∆∞·ªõng n·ªôi - TB):
                    // Hi·ªán: ƒêi·ªÉm danh, 2 nhi·ªám v·ª• ƒë·ªông (Profile, Quiz n√¢ng cao - gi·∫£ l·∫≠p), M·ªùi b·∫°n b√®
                    // ·∫®n: Share FB
                    tasksToShow = [tasksDB.attendance, tasksDB.profile, tasksDB.invite];
                    break;

                case 'introvert_good':
                    // Segment 3 (H∆∞·ªõng n·ªôi - Kh√°/Gi·ªèi):
                    // Hi·ªán: ƒêi·ªÉm danh, Nhi·ªám v·ª• h·ªçc t·∫≠p (Quiz advanced), M·ªùi b·∫°n b√®
                    // Share FB (Xu·ªëng cu·ªëi)
                    tasksToShow = [tasksDB.attendance, tasksDB.quiz_advanced, tasksDB.invite, tasksDB.share_fb];
                    break;

                case 'extrovert_average':
                    // Segment 4 (H∆∞·ªõng ngo·∫°i - TB):
                    // Hi·ªán Full: ƒêi·ªÉm danh, M·ªùi b·∫°n b√®, Share FB, 2 nhi·ªám v·ª• ƒë·ªông
                    tasksToShow = [tasksDB.attendance, tasksDB.invite, tasksDB.share_fb, tasksDB.profile];
                    break;

                case 'extrovert_good':
                    // Segment 5 (H∆∞·ªõng ngo·∫°i - Kh√°/Gi·ªèi):
                    // Hi·ªán: ƒêi·ªÉm danh, Share K·∫øt qu·∫£ (share_result), Share FB, M·ªùi b·∫°n b√®
                    tasksToShow = [tasksDB.attendance, tasksDB.share_result, tasksDB.share_fb, tasksDB.invite, tasksDB.quiz_advanced];
                    break;
            }

            let html = '';
            tasksToShow.forEach((t, index) => {
                let badge = t.hot ? `<span style="background:#FEF3C7; color:#D97706; padding:2px 6px; border-radius:4px; font-size:10px; border:1px solid #FCD34D; margin-left:6px;">HOT</span>` : '';
                
                // Logic l√†m m·ªù n√∫t invite cho Introvert Average (User kh√¥ng b·ªã √°p l·ª±c)
                let opacityStyle = (segment === 'introvert_average' && (t === tasksDB.invite)) ? 'opacity: 0.8;' : '';

                html += `
                <div class="task-card" style="animation-delay: ${index * 0.1}s; ${opacityStyle}">
                    <div class="task-left">
                        <div class="task-icon"><i class="fa-solid ${t.icon}"></i></div>
                        <div class="task-info">
                            <h3>${t.title} ${badge}</h3>
                            <p>${t.sub}</p>
                        </div>
                    </div>
                    <button class="btn-action">${t.btn}</button>
                </div>`;
            });

            board.innerHTML = html;
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 3000);
        }
    </script>
</body>
</html>