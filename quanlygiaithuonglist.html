<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luyện Đề ERP - Quản Lý Giải Thưởng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f3f4f6; }
        
        /* Sort Icons */
        .sort-icon { cursor: pointer; margin-left: 5px; color: #9ca3af; font-size: 12px; }
        .sort-icon.active { color: #f97316; }

        /* Filter Inputs */
        .filter-input {
            width: 100%;
            margin-top: 6px;
            padding: 5px 8px;
            font-size: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            outline: none;
            font-weight: normal;
            color: #475569;
            background-color: #fff;
            transition: border-color 0.2s;
        }
        .filter-input:focus { border-color: #f97316; box-shadow: 0 0 0 2px rgba(249, 115, 22, 0.1); }

        /* Badge Styles */
        .badge-event { background-color: #eff6ff; color: #2563eb; border: 1px solid #dbeafe; padding: 2px 8px; border-radius: 4px; font-family: monospace; font-size: 11px; font-weight: bold; }
        .badge-empty { color: #94a3b8; font-style: italic; font-size: 12px; }
        
        .type-voucher { color: #059669; background-color: #ecfdf5; border: 1px solid #d1fae5; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .type-gift { color: #d97706; background-color: #fffbeb; border: 1px solid #fef3c7; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <!-- SIDEBAR (Giữ nguyên style) -->
    <aside class="w-64 bg-slate-800 text-white flex flex-col flex-shrink-0">
        <div class="p-6 border-b border-slate-700 flex items-center gap-3">
            <i class="fa-solid fa-layer-group text-orange-500 text-2xl"></i>
            <div><h1 class="text-xl font-bold text-orange-500">Luyện Đề ERP</h1><p class="text-xs text-slate-400">v2.1</p></div>
        </div>
        <nav class="flex-1 py-4">
            <ul class="space-y-1">
                <li><a href="#" class="flex items-center gap-3 px-6 py-3 text-slate-300 hover:bg-slate-700 transition"><i class="fa-solid fa-chart-pie w-5"></i> Dashboard</a></li>
                <li><a href="#" class="flex items-center gap-3 px-6 py-3 text-slate-300 hover:bg-slate-700 transition"><i class="fa-solid fa-bullseye w-5"></i> Events</a></li>
                <!-- Active Item -->
                <li><a href="#" class="flex items-center gap-3 px-6 py-3 bg-slate-700 text-white border-l-4 border-orange-500"><i class="fa-solid fa-gift w-5"></i> Giải Thưởng</a></li>
                <li><a href="#" class="flex items-center gap-3 px-6 py-3 text-slate-300 hover:bg-slate-700 transition"><i class="fa-solid fa-chart-line w-5"></i> Báo Cáo</a></li>
            </ul>
        </nav>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col overflow-hidden">
        <!-- Header -->
        <header class="bg-white shadow-sm px-8 py-5 flex justify-between items-center z-10">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center text-orange-600">
                    <i class="fa-solid fa-gifts text-xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-slate-800">Quản Lý Kho Giải Thưởng</h2>
            </div>
            <button class="bg-orange-500 hover:bg-orange-600 text-white px-5 py-2.5 rounded-lg font-semibold shadow-md transition flex items-center gap-2">
                <i class="fa-solid fa-plus"></i> Tạo Giải Thưởng Mới
            </button>
        </header>

        <!-- Content -->
        <div class="flex-1 overflow-auto p-8">
            <div class="bg-white rounded-xl shadow-md border border-gray-200 flex flex-col h-full max-h-[calc(100vh-140px)]">
                
                <!-- Table -->
                <div class="overflow-auto flex-1">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-gray-50 sticky top-0 z-10 shadow-sm">
                            <tr>
                                <!-- Column: Reward Name -->
                                <th class="px-6 py-4 font-semibold text-gray-700 text-sm min-w-[220px]">
                                    <div class="flex items-center justify-between cursor-pointer group" onclick="sortTable('name')">
                                        Tên giải thưởng <i class="fa-solid fa-sort sort-icon group-hover:text-gray-500" id="sort-name"></i>
                                    </div>
                                    <input type="text" class="filter-input" placeholder="Lọc tên..." onkeyup="filterData('name', this.value)">
                                </th>

                                <!-- Column: Code -->
                                <th class="px-6 py-4 font-semibold text-gray-700 text-sm min-w-[120px]">
                                    <div class="flex items-center justify-between cursor-pointer group" onclick="sortTable('code')">
                                        Mã <i class="fa-solid fa-sort sort-icon group-hover:text-gray-500" id="sort-code"></i>
                                    </div>
                                    <input type="text" class="filter-input" placeholder="Lọc mã..." onkeyup="filterData('code', this.value)">
                                </th>

                                <!-- Column: Type -->
                                <th class="px-6 py-4 font-semibold text-gray-700 text-sm w-[140px]">
                                    <div class="flex items-center justify-between cursor-pointer group" onclick="sortTable('type')">
                                        Loại <i class="fa-solid fa-sort sort-icon group-hover:text-gray-500" id="sort-type"></i>
                                    </div>
                                    <select class="filter-input" onchange="filterData('type', this.value)">
                                        <option value="">Tất cả</option>
                                        <option value="Voucher">Voucher</option>
                                        <option value="Hiện vật">Hiện vật</option>
                                    </select>
                                </th>

                                <!-- Column: Value -->
                                <th class="px-6 py-4 font-semibold text-gray-700 text-sm text-right min-w-[140px]">
                                    <div class="flex items-center justify-end gap-2 cursor-pointer group" onclick="sortTable('value')">
                                        Giá trị (VNĐ) <i class="fa-solid fa-sort sort-icon group-hover:text-gray-500" id="sort-value"></i>
                                    </div>
                                    <input type="text" class="filter-input text-right" placeholder=">= Giá trị..." onkeyup="filterData('value', this.value)">
                                </th>

                                <!-- Column: Quantity -->
                                <th class="px-6 py-4 font-semibold text-gray-700 text-sm text-center w-[120px]">
                                    <div class="flex items-center justify-center gap-2 cursor-pointer group" onclick="sortTable('qty')">
                                        Tồn kho <i class="fa-solid fa-sort sort-icon group-hover:text-gray-500" id="sort-qty"></i>
                                    </div>
                                    <input type="number" class="filter-input text-center" placeholder="Số lg..." onkeyup="filterData('qty', this.value)">
                                </th>

                                <!-- Column: Linked Event (New) -->
                                <th class="px-6 py-4 font-semibold text-gray-700 text-sm min-w-[150px]">
                                    <div class="flex items-center justify-between cursor-pointer group" onclick="sortTable('event')">
                                        Event liên kết <i class="fa-solid fa-sort sort-icon group-hover:text-gray-500" id="sort-event"></i>
                                    </div>
                                    <input type="text" class="filter-input" placeholder="Mã event..." onkeyup="filterData('event', this.value)">
                                </th>

                                <!-- Column: Actions -->
                                <th class="px-6 py-4 font-semibold text-gray-700 text-sm text-center w-[100px]">
                                    Actions
                                    <div class="h-[34px]"></div>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="tableBody" class="divide-y divide-gray-100">
                            <!-- Rows populated by JS -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="border-t border-gray-200 p-4 bg-gray-50 flex justify-between items-center rounded-b-xl">
                    <p class="text-sm text-gray-600">
                        Hiển thị <span class="font-bold text-slate-800" id="startItem">1</span> - <span class="font-bold text-slate-800" id="endItem">10</span> / <span class="font-bold text-slate-800" id="totalItems">0</span>
                    </p>
                    <div class="flex gap-2">
                        <button onclick="prevPage()" id="btnPrev" class="px-3 py-1.5 border border-gray-300 rounded bg-white text-sm font-medium hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fa-solid fa-chevron-left text-xs mr-1"></i> Trước
                        </button>
                        <button onclick="nextPage()" id="btnNext" class="px-3 py-1.5 border border-gray-300 rounded bg-white text-sm font-medium hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            Sau <i class="fa-solid fa-chevron-right text-xs ml-1"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- DATA GENERATION ---
        const rewards = [
            { id: 1, name: "Voucher Urbox 50k", code: "URB50", type: "Voucher", value: 50000, qty: 1250, event: "DDST1" },
            { id: 2, name: "Voucher GotIt 100k", code: "GOT100", type: "Voucher", value: 100000, qty: 300, event: "DDST2" },
            { id: 3, name: "Balo Luyện Đề Limited", code: "BALO_LTD", type: "Hiện vật", value: 450000, qty: 45, event: "" },
            { id: 4, name: "Sách Bí kíp luyện thi", code: "BOOK_BK", type: "Hiện vật", value: 120000, qty: 200, event: "DDST1" },
            { id: 5, name: "Thẻ cào Viettel 20k", code: "CARD_VT20", type: "Voucher", value: 20000, qty: 5000, event: "" },
            { id: 6, name: "Voucher Tiki 200k", code: "TIKI200", type: "Voucher", value: 200000, qty: 50, event: "DDST3" },
            { id: 7, name: "Áo thun Đường Đua", code: "SHIRT_DD", type: "Hiện vật", value: 150000, qty: 100, event: "DDST2" },
            { id: 8, name: "Voucher Shopee 50k", code: "SHOPEE50", type: "Voucher", value: 50000, qty: 800, event: "" },
            { id: 9, name: "Tai nghe Bluetooth", code: "HEADPHONE", type: "Hiện vật", value: 350000, qty: 20, event: "DDST4" },
            { id: 10, name: "Sổ tay thông thái", code: "NOTEBOOK", type: "Hiện vật", value: 30000, qty: 1000, event: "" },
            { id: 11, name: "Voucher CGV 100k", code: "CGV100", type: "Voucher", value: 100000, qty: 150, event: "DDST5" },
            { id: 12, name: "Bình giữ nhiệt", code: "THERMOS", type: "Hiện vật", value: 180000, qty: 60, event: "" }
        ];

        // Generate more dummy data
        for(let i=13; i<=30; i++) {
            rewards.push({
                id: i,
                name: `Giải thưởng Test ${i}`,
                code: `TEST_${i}`,
                type: i % 2 === 0 ? "Voucher" : "Hiện vật",
                value: (i * 10000),
                qty: i * 5,
                event: i % 3 === 0 ? `DDST${Math.floor(i/3)}` : ""
            });
        }

        // --- STATE ---
        let currentData = [...rewards];
        let currentPage = 1;
        const itemsPerPage = 10;
        let currentSort = { column: '', order: 'asc' };
        let filters = { name: '', code: '', type: '', value: '', qty: '', event: '' };

        // --- FUNCTIONS ---

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedData = currentData.slice(start, end);

            if (paginatedData.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7" class="px-6 py-8 text-center text-slate-500">Không tìm thấy dữ liệu</td></tr>`;
            } else {
                paginatedData.forEach(item => {
                    // Event Logic
                    let eventBadge = `<span class="badge-empty">--</span>`;
                    if (item.event) {
                        eventBadge = `<span class="badge-event" title="Đang dùng cho event này">${item.event}</span>`;
                    }

                    // Type Badge
                    const typeClass = item.type === 'Voucher' ? 'type-voucher' : 'type-gift';
                    const typeIcon = item.type === 'Voucher' ? 'fa-ticket' : 'fa-box-open';

                    const row = `
                        <tr class="hover:bg-orange-50 transition border-b border-gray-100 last:border-0">
                            <td class="px-6 py-3 font-medium text-slate-700">
                                <div class="flex items-center gap-2">
                                    <div class="w-8 h-8 rounded bg-gray-100 flex items-center justify-center text-gray-400 text-xs">IMG</div>
                                    ${item.name}
                                </div>
                            </td>
                            <td class="px-6 py-3 text-sm text-slate-500 font-mono">${item.code}</td>
                            <td class="px-6 py-3">
                                <span class="${typeClass}"><i class="fa-solid ${typeIcon} mr-1"></i> ${item.type}</span>
                            </td>
                            <td class="px-6 py-3 text-sm text-slate-700 font-bold text-right">${item.value.toLocaleString()}</td>
                            <td class="px-6 py-3 text-sm text-slate-600 text-center">${item.qty.toLocaleString()}</td>
                            <td class="px-6 py-3 text-center">${eventBadge}</td>
                            <td class="px-6 py-3 text-center">
                                <button class="text-blue-600 hover:text-blue-800 font-medium text-sm flex items-center justify-center w-full gap-1">
                                    <i class="fa-regular fa-pen-to-square"></i> Sửa
                                </button>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            }

            // Update Pagination Info
            document.getElementById('startItem').innerText = currentData.length > 0 ? start + 1 : 0;
            document.getElementById('endItem').innerText = Math.min(end, currentData.length);
            document.getElementById('totalItems').innerText = currentData.length;
            
            document.getElementById('btnPrev').disabled = currentPage === 1;
            document.getElementById('btnNext').disabled = end >= currentData.length;
        }

        function filterData(column, val) {
            filters[column] = val.toLowerCase();
            
            currentData = rewards.filter(item => {
                const matchName = item.name.toLowerCase().includes(filters.name);
                const matchCode = item.code.toLowerCase().includes(filters.code);
                const matchType = filters.type === '' || item.type === filters.type; // Exact match for select
                const matchValue = filters.value === '' || item.value >= parseInt(filters.value); // Number logic
                const matchQty = filters.qty === '' || item.qty >= parseInt(filters.qty);
                const matchEvent = item.event.toLowerCase().includes(filters.event);

                return matchName && matchCode && matchType && matchValue && matchQty && matchEvent;
            });

            // Re-sort if active
            if(currentSort.column) sortDataInternal();

            currentPage = 1;
            renderTable();
        }

        function sortTable(column) {
            if (currentSort.column === column) {
                currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.order = 'asc';
            }

            // UI Update
            document.querySelectorAll('.sort-icon').forEach(i => i.className = 'fa-solid fa-sort sort-icon');
            const activeIcon = document.getElementById(`sort-${column}`);
            if(activeIcon) activeIcon.className = `fa-solid fa-sort-${currentSort.order === 'asc' ? 'up' : 'down'} sort-icon active`;

            sortDataInternal();
            renderTable();
        }

        function sortDataInternal() {
            const { column, order } = currentSort;
            currentData.sort((a, b) => {
                let valA = a[column];
                let valB = b[column];

                // Handle empty strings for event
                if (column === 'event') {
                    valA = valA || '';
                    valB = valB || '';
                }

                if (typeof valA === 'string') {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }

                if (valA < valB) return order === 'asc' ? -1 : 1;
                if (valA > valB) return order === 'asc' ? 1 : -1;
                return 0;
            });
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderTable();
            }
        }

        function nextPage() {
            if ((currentPage * itemsPerPage) < currentData.length) {
                currentPage++;
                renderTable();
            }
        }

        // Init
        renderTable();

    </script>
</body>
</html>