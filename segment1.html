<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê∆∞·ªùng ƒêua Sƒ© T·ª≠</title>
    <style>
        :root {
            --primary-orange: #FF7A45;
            --hover-orange: #E66A35;
            --bg-orange-light: #FFF7ED;
            --bg-orange-medium: #FFEDD5;
            --text-gray: #6B7280;
            --text-dark: #1F2937;
            --border-gray: #E5E7EB;
            --bg-gray: #F3F4F6;
            --bg-white: #FFFFFF;
            --radius: 12px;
            --shadow-card: 0 2px 8px rgba(0,0,0,0.05);
            --shadow-popup: 0 20px 60px rgba(0,0,0,0.3);
            --font-main: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: var(--font-main); }
        
        body { background-color: #F9FAFB; display: flex; justify-content: center; min-height: 100vh; padding: 20px 0; }
        
        /* Container */
        .app-container {
            width: 100%;
            max-width: 600px; /* Mobile focused but looks good on desktop */
            background: white;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }
        
        @media (min-width: 1440px) {
            .app-container { max-width: 800px; border-radius: 20px; min-height: auto; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        }

        /* Typography */
        h2 { font-size: 20px; font-weight: 700; color: var(--text-dark); margin-bottom: 4px; }
        .subtitle { font-size: 14px; color: var(--text-gray); margin-bottom: 24px; }
        .card-title { font-size: 16px; font-weight: 600; color: var(--text-dark); }
        .card-desc { font-size: 14px; color: var(--text-gray); margin-top: 4px; }

        /* Button Standard */
        .btn {
            background-color: var(--primary-orange);
            color: white;
            border: none;
            border-radius: var(--radius);
            padding: 12px 24px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s;
            width: 100%;
            margin-top: 16px;
        }
        .btn:hover { background-color: var(--hover-orange); }
        .btn:disabled { background-color: var(--border-gray); cursor: not-allowed; color: #9CA3AF; }
        
        /* Task Cards */
        .task-list { display: flex; flex-direction: column; gap: 16px; }
        
        .card {
            background: white;
            border: 1px solid var(--border-gray);
            border-radius: var(--radius);
            padding: 20px;
            position: relative;
            transition: all 0.2s ease;
        }

        .card:hover { border-color: var(--primary-orange); box-shadow: var(--shadow-card); }

        .card-header { display: flex; align-items: flex-start; gap: 12px; }
        .card-icon { font-size: 24px; flex-shrink: 0; }
        .card-content { flex-grow: 1; }
        
        .badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--bg-orange-light);
            color: var(--primary-orange);
            font-size: 12px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 6px;
        }

        /* Locked State Specifics */
        .card.locked {
            background-color: var(--bg-gray);
            opacity: 0.8;
            border: 1px solid transparent;
        }
        .card.locked .card-title, .card.locked .card-desc { color: #9CA3AF; }
        .locked-badge { font-size: 12px; font-weight: 700; color: #9CA3AF; margin-right: 4px; }

        /* Active Trigger Card (Locked Screen) */
        .card.trigger {
            background: linear-gradient(to right, #FFF7ED, #FFEDD5);
            border: 1px solid var(--primary-orange);
        }

        /* MODALS */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            width: 100%;
            max-width: 540px;
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-popup);
            position: relative;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Survey Styles */
        .survey-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .progress-dots { display: flex; gap: 6px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; background: #E5E7EB; }
        .dot.active { background: var(--primary-orange); }

        .question-box {
            background: #F9FAFB;
            padding: 16px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 16px;
            margin-bottom: 20px;
            color: var(--text-dark);
        }

        .options-container { display: flex; flex-direction: column; gap: 12px; }
        
        .option-item {
            display: flex; align-items: center; gap: 12px;
            padding: 16px;
            border: 1px solid var(--border-gray);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-item.selected {
            border-color: var(--primary-orange);
            background-color: var(--bg-orange-light);
        }

        .radio-circle {
            width: 20px; height: 20px;
            border: 2px solid #D1D5DB;
            border-radius: 50%;
            position: relative;
        }
        
        .option-item.selected .radio-circle {
            border-color: var(--primary-orange);
        }
        
        .option-item.selected .radio-circle::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 10px; height: 10px;
            background: var(--primary-orange);
            border-radius: 50%;
        }

        .modal-footer { margin-top: 24px; display: flex; justify-content: flex-end; }
        .close-icon { position: absolute; top: 16px; right: 16px; cursor: pointer; font-size: 20px; color: #9CA3AF; }

        /* Success Styles */
        .success-content { text-align: center; padding: 20px 0; }
        .points-display { font-size: 48px; font-weight: 800; color: var(--primary-orange); margin: 10px 0; }
        .divider { height: 1px; background: #E5E7EB; margin: 20px 0; width: 100%; }
        .confetti { font-size: 24px; position: absolute; animation: fall 3s infinite linear; }

        /* Utility */
        .hidden { display: none !important; }
        .text-orange { color: var(--primary-orange); }

    </style>
</head>
<body>

    <!-- SCREEN 1 & 4 CONTAINER -->
    <div class="app-container" id="mainScreen">
        <header>
            <h2>üìä Nhi·ªám v·ª• c·ªßa b·∫°n</h2>
            <p class="subtitle">Ho√†n th√†nh c√°c nhi·ªám v·ª• ƒë·ªÉ ƒë∆∞·ª£c nh·∫≠n th∆∞·ªüng</p>
        </header>

        <!-- Dynamic List Container -->
        <div class="task-list" id="taskList">
            <!-- Content will be injected by JS -->
        </div>
    </div>

    <!-- SCREEN 2: SURVEY MODAL -->
    <div class="modal-overlay" id="surveyModal">
        <div class="modal-content">
            <div class="close-icon" onclick="closeModal('surveyModal')">‚úï</div>
            <div class="survey-header">
                <h2>üéì Kh·∫£o s√°t t√≠nh c√°ch</h2>
                <div class="progress-dots" id="progressDots">
                    <span class="dot active"></span><span class="dot"></span><span class="dot"></span>
                </div>
            </div>
            
            <div id="surveyQuestionContainer">
                <div class="question-box" id="questionText">Loading...</div>
                <div class="options-container" id="optionsList">
                    <!-- Options injected here -->
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn" id="nextBtn" style="width: auto; padding: 10px 32px;" disabled>Ti·∫øp theo</button>
            </div>
        </div>
    </div>

    <!-- SCREEN 3: SUCCESS MODAL -->
    <div class="modal-overlay" id="successModal">
        <div class="modal-content success-content">
            <div>üéâ üéâ üéâ</div>
            <p style="margin-top:10px; font-size: 18px; color:#374151;">B·∫†N NH·∫¨N ƒê∆Ø·ª¢C</p>
            <div class="points-display">100 ‚ö°</div>
            <div class="divider"></div>
            <h3 style="margin-bottom:8px;">Ho√†n th√†nh nhi·ªám v·ª•: K√≠ch ho·∫°t ƒë∆∞·ªùng ƒëua</h3>
            <p style="font-size:13px; color:gray; font-style:italic;">H√£y ti·∫øp t·ª•c ho√†n th√†nh c√°c nhi·ªám v·ª• kh√°c ƒë·ªÉ gi√†nh ƒë∆∞·ª£c gi·∫£i th∆∞·ªüng nh√©.</p>
            <button class="btn" id="successBtn">Ti·∫øp t·ª•c (5s)</button>
        </div>
    </div>

    <script>
        // --- DATA CONFIGURATION ---
        
        // Locked Task Data (Initial View)
        const lockedTasks = [
            { icon: 'üîí', title: 'ƒêƒÉng nh·∫≠p h√†ng ng√†y Ng√†y 1', desc: 'Nh·∫≠n ƒëi·ªÉm ngay', points: 100 },
            { icon: 'üîí', title: 'M·ªü 3 b·∫°n b√®', desc: 'M·ªùi b·∫°n b√® tham gia', points: 100 },
            { icon: 'üîí', title: 'Chia s·∫ª Facebook', desc: 'Chia s·∫ª c√¥ng khai', points: 100 },
            { icon: 'üîí', title: 'Chia s·∫ª k·∫øt qu·∫£ h·ªçc t·∫≠p', desc: 'Khoe th√†nh t√≠ch', points: 100 },
            { icon: 'üîí', title: 'Repost TikTok', desc: 'Repost video', points: 50 },
            { icon: 'üîí', title: 'Chia s·∫ª Zalo Feed', desc: 'ƒêƒÉng l√™n nh·∫≠t k√Ω', points: 50 },
            { icon: 'üîí', title: 'M·ªùi b·∫°n v√†o FB Group', desc: 'Tham gia c·ªông ƒë·ªìng', points: 50 },
            { icon: 'üîí', title: 'C·∫≠p nh·∫≠t h·ªì s∆°', desc: 'ƒêi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin', points: 50 }
        ];

        // All Possible Active Tasks
        const allTasks = {
            login: { icon: 'üìÖ', title: 'ƒêƒÉng nh·∫≠p h√†ng ng√†y Ng√†y 1', desc: 'Nh·∫≠n ƒëi·ªÉm danh ngay', points: 100, btn: 'Nh·∫≠n ƒëi·ªÉm ngay' },
            fbShare: { icon: 'üíö', title: 'Chia s·∫ª link l√™n Facebook', desc: 'Chia s·∫ª c√¥ng khai ƒë·ªÉ b·∫°n b√® c√πng bi·∫øt', points: 100, btn: 'Chia s·∫ª ngay' },
            invite: { icon: 'üë•', title: 'M·ªùi 3 b·∫°n b√® (c√≥ x√°c th·ª±c SDT)', desc: 'M·ªùi b·∫°n b√® c√πng tham gia', points: 100, btn: 'M·ªùi b·∫°n b√®' },
            resultShare: { icon: 'üìä', title: 'Chia s·∫ª k·∫øt qu·∫£ h·ªçc t·∫≠p', desc: 'L∆∞u l·∫°i th√†nh t√≠ch c·ªßa b·∫°n', points: 100, btn: 'Chia s·∫ª ngay' },
            tiktok: { icon: 'üéµ', title: 'Repost TikTok', desc: 'Repost video m·ªõi nh·∫•t', points: 50, btn: 'Repost ngay' },
            zalo: { icon: 'üí¨', title: 'Chia s·∫ª Zalo Feed', desc: 'ƒêƒÉng l√™n nh·∫≠t k√Ω Zalo', points: 50, btn: 'Chia s·∫ª ngay' },
            group: { icon: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', title: 'M·ªùi b·∫°n v√†o FB Group', desc: 'Gia nh·∫≠p c·ªông ƒë·ªìng sƒ© t·ª≠', points: 50, btn: 'Tham gia ngay' },
        };

        // Survey Questions
        const questions = [
            {
                q: 'G·∫∑p b√†i To√°n "si√™u khoai", ph·∫£n x·∫° ƒë·∫ßu ti√™n l√†?',
                options: [
                    { text: 'T·ª± l·ª±c c√°nh sinh: Tra Google, chat GPT, s√°ch.', val: 'independent' },
                    { text: 'C·∫ßu c·ª©u ng∆∞·ªùi th√¢n: Ch·ª•p ·∫£nh h·ªèi b·∫°n b√®/th·∫ßy c√¥.', val: 'dependent' }
                ]
            },
            {
                q: 'Kh√¥ng gian "tu luy·ªán" l√Ω t∆∞·ªüng c·ªßa b·∫°n?',
                options: [
                    { text: '·∫®n danh: Y√™n tƒ©nh tuy·ªát ƒë·ªëi, ƒëeo tai nghe.', val: 'introvert' }, // H∆∞·ªõng n·ªôi
                    { text: 'S√¥i ƒë·ªông: Th·∫•y b·∫°n b√® online, c√≥ BXH nh·∫£y s·ªë.', val: 'extrovert' } // H∆∞·ªõng ngo·∫°i
                ]
            },
            {
                q: 'T∆∞·ªüng t∆∞·ª£ng ƒë·∫°t 9 ƒëi·ªÉm To√°n, c·∫£m x√∫c l√†?',
                options: [
                    { text: 'Vui th·∫ßm: L∆∞u l·∫°i ƒë·ªÉ t·ª± so s√°nh v·ªõi m√¨nh.', val: 'tb' }, // Trung b√¨nh/Khi√™m t·ªën
                    { text: 'Ph·∫•n kh√≠ch: Ch·ª•p m√†n h√¨nh khoe Story ngay.', val: 'kg' } // Kh√° gi·ªèi/T·ª± tin
                ]
            }
        ];

        // --- STATE MANAGEMENT ---
        let currentStep = 0;
        let answers = {};
        let countdownTimer = null;

        // --- RENDER FUNCTIONS ---

        function renderLockedScreen() {
            const list = document.getElementById('taskList');
            list.innerHTML = '';

            // 1. Active Trigger Card
            const triggerCard = document.createElement('div');
            triggerCard.className = 'card trigger';
            triggerCard.innerHTML = `
                <span class="badge">+50‚ö°</span>
                <div class="card-header">
                    <div class="card-icon">‚ö°</div>
                    <div class="card-content">
                        <div class="card-title">K√≠ch ho·∫°t ƒë∆∞·ªùng ƒëua sƒ© t·ª≠</div>
                        <div class="card-desc">Ho√†n th√†nh kh·∫£o s√°t ƒë·ªÉ nh·∫≠n th∆∞·ªüng v√† m·ªü kh√≥a ƒë∆∞·ªùng ƒëua sƒ© t·ª≠ n√†o </div>
                        <button class="btn" onclick="startSurvey()">K√≠ch ho·∫°t ngay</button>
                    </div>
                </div>
            `;
            list.appendChild(triggerCard);

            // 2. Locked Cards
            lockedTasks.forEach(task => {
                const card = document.createElement('div');
                card.className = 'card locked';
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-icon">${task.icon}</div>
                        <div class="card-content">
                            <div class="card-title"><span class="locked-badge">[LOCKED]</span>${task.title}</div>
                            <div class="card-desc">${task.desc}</div>
                        </div>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        function renderUnlockedScreen(variant) {
            const list = document.getElementById('taskList');
            list.innerHTML = '';
            
            // Logic to determine task order based on variant
            // Variants: 'introvert-tb', 'introvert-kg', 'extrovert-tb', 'extrovert-kg'
            
            let taskOrder = [];

            if (variant === 'extrovert-tb') {
                // Default logic from prompt (Screen 4)
                taskOrder = ['login', 'fbShare', 'invite', 'resultShare', 'tiktok', 'zalo', 'group'];
            } else if (variant === 'introvert-tb') {
                // Hide social heavy stuff (tiktok, zalo, group), move Invite to #3
                taskOrder = ['login', 'resultShare', 'invite', 'fbShare']; 
            } else if (variant === 'introvert-kg') {
                // Prioritize Result Share
                taskOrder = ['login', 'resultShare', 'invite', 'fbShare', 'tiktok'];
            } else if (variant === 'extrovert-kg') {
                // Result share #3 before FB
                taskOrder = ['login', 'invite', 'resultShare', 'fbShare', 'tiktok', 'zalo', 'group'];
            } else {
                // Fallback
                taskOrder = ['login', 'fbShare', 'invite', 'resultShare'];
            }

            // Render Active Tasks
            taskOrder.forEach(key => {
                const t = allTasks[key];
                if (!t) return;
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <span class="badge text-orange">+${t.points}‚ö°</span>
                    <div class="card-header">
                        <div class="card-icon">${t.icon}</div>
                        <div class="card-content">
                            <div class="card-title">${t.title}</div>
                            <div class="card-desc">${t.desc}</div>
                            <button class="btn">${t.btn}</button>
                        </div>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        // --- SURVEY LOGIC ---

        function startSurvey() {
            currentStep = 0;
            answers = {};
            document.getElementById('surveyModal').style.display = 'flex';
            renderQuestion();
        }

        function renderQuestion() {
            const q = questions[currentStep];
            document.getElementById('questionText').innerText = `C√¢u ${currentStep + 1}: ${q.q}`;
            
            // Update dots
            const dots = document.querySelectorAll('.dot');
            dots.forEach((d, i) => d.className = `dot ${i <= currentStep ? 'active' : ''}`);

            // Render Options
            const optsContainer = document.getElementById('optionsList');
            optsContainer.innerHTML = '';
            
            q.options.forEach((opt, idx) => {
                const el = document.createElement('div');
                el.className = 'option-item';
                el.onclick = () => selectOption(idx, opt.val, el);
                el.innerHTML = `
                    <div class="radio-circle"></div>
                    <span>${opt.text}</span>
                `;
                optsContainer.appendChild(el);
            });

            // Reset Button
            const btn = document.getElementById('nextBtn');
            btn.disabled = true;
            btn.innerText = (currentStep === questions.length - 1) ? 'Ho√†n th√†nh' : 'Ti·∫øp theo';
            btn.onclick = nextStep;
        }

        let selectedValue = null;

        function selectOption(index, val, element) {
            // UI Update
            document.querySelectorAll('.option-item').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            
            // Logic Update
            selectedValue = val;
            document.getElementById('nextBtn').disabled = false;
        }

        function nextStep() {
            // Save answer
            if (currentStep === 1) answers.personality = selectedValue; // introvert/extrovert
            if (currentStep === 2) answers.level = selectedValue; // tb/kg

            if (currentStep < questions.length - 1) {
                currentStep++;
                selectedValue = null;
                renderQuestion();
            } else {
                finishSurvey();
            }
        }

        function finishSurvey() {
            document.getElementById('surveyModal').style.display = 'none';
            showSuccess();
        }

        // --- SUCCESS & RESULT LOGIC ---

        function showSuccess() {
            const modal = document.getElementById('successModal');
            modal.style.display = 'flex';
            
            let seconds = 5;
            const btn = document.getElementById('successBtn');
            btn.innerText = `Ti·∫øp t·ª•c (${seconds}s)`;

            countdownTimer = setInterval(() => {
                seconds--;
                btn.innerText = `Ti·∫øp t·ª•c (${seconds}s)`;
                if (seconds <= 0) {
                    clearInterval(countdownTimer);
                    closeSuccess();
                }
            }, 1000);
            
            btn.onclick = () => {
                clearInterval(countdownTimer);
                closeSuccess();
            };
        }

        function closeSuccess() {
            document.getElementById('successModal').style.display = 'none';
            
            // Calculate Variant
            // Default to extrovert-tb if undefined
            const p = answers.personality || 'extrovert';
            const l = answers.level || 'tb';
            const variant = `${p}-${l}`;
            
            console.log("Variant calculated:", variant);
            renderUnlockedScreen(variant);
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        // --- INITIALIZATION ---
        window.onload = function() {
            renderLockedScreen();
        };

    </script>
</body>
</html>